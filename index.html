<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zn-han">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="blogs and research">
<meta property="og:type" content="website">
<meta property="og:title" content="shengfq&#39;s blog">
<meta property="og:url" content="https://shengfq.github.io/index.html">
<meta property="og:site_name" content="shengfq&#39;s blog">
<meta property="og:description" content="blogs and research">
<meta property="og:locale" content="zn-han">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="shengfq&#39;s blog">
<meta name="twitter:description" content="blogs and research">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://shengfq.github.io/"/>





  <title>shengfq's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zn-han">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">shengfq's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">an developer using java</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shengfq.github.io/2018/11/19/JUC-ArrayBlockingQueue源码分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shengfq's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/19/JUC-ArrayBlockingQueue源码分析/" itemprop="url">JUC多线程系列-ArrayBlockingQueue源码分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-19T00:00:00+08:00">
                2018-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>JUC多线程系列-ArrayBlockingQueue源码分析</h2><br><h3>背景</h3><br>最近在项目中应用到后台异步任务并发应用,干脆系统的撸一遍JUC,然后应用到项目中实战.<br><br><p>使用阻塞队列实现生产者消费者模式</p><br>优点:阻塞队列实现生产者消费者模式超级简单，它提供开箱即用支持阻塞的方法put()和take()，开发者不需要写困惑的wait-nofity代码去实现通信。BlockingQueue 一个接口，Java5提供了不同的现实，如ArrayBlockingQueue和LinkedBlockingQueue，两者都是先进先出（FIFO）顺序。而ArrayLinkedQueue是自然有界的，LinkedBlockingQueue可选的边界。下面这是一个完整的生产者消费者代码例子，对比传统的wait、nofity代码，它更易于理解。<br><br><br><h3>目录</h3><br><ol><br><li> ArrayBlockingQueue介绍</li><br><li>ArrayBlockingQueue原理和数据结构</li><br><li> ArrayBlockingQueue函数列表</li><br><li> ArrayBlockingQueue源码分析(JDK1.8版本)</li><br><li>ArrayBlockingQueue示例</li><br></ol><br><br><h2>正文</h2><br><h2>1.ArrayBlockingQueue介绍</h2><br>ArrayBlockingQueue是数组实现的线程安全的有界的阻塞队列。<br>线程安全是指，ArrayBlockingQueue内部通过“互斥锁”保护竞争资源，实现了多线程对竞争资源的互斥访问。而有界，则是指ArrayBlockingQueue对应的数组是有界限的。 阻塞队列，是指多线程访问竞争资源时，当竞争资源已被某线程获取时，其它要获取该资源的线程需要阻塞等待；而且，ArrayBlockingQueue是按 FIFO（先进先出）原则对元素进行排序，元素都是从尾部插入到队列，从头部开始返回。<br><br><br><br><a>注意：ArrayBlockingQueue不同于ConcurrentLinkedQueue，ArrayBlockingQueue是数组实现的，并且是有界限的；而ConcurrentLinkedQueue是链表实现的，是无界限的。<br></a><br><br><h2>2.ArrayBlockingQueue原理和数据结构</h2><br><ol><br><li> ArrayBlockingQueue继承于AbstractQueue，并且它实现了BlockingQueue接口。</li><br><li>  ArrayBlockingQueue内部是通过Object[]数组保存数据的，也就是说ArrayBlockingQueue本质上是通过数组实现的。ArrayBlockingQueue的大小，即数组的容量是创建ArrayBlockingQueue时指定的。</li><br><li>  ArrayBlockingQueue与ReentrantLock是组合关系，ArrayBlockingQueue中包含一个ReentrantLock对象(lock)。ReentrantLock是可重入的互斥锁，ArrayBlockingQueue就是根据该互斥锁实现“多线程对竞争资源的互斥访问”。而且，ReentrantLock分为公平锁和非公平锁，关于具体使用公平锁还是非公平锁，在创建ArrayBlockingQueue时可以指定；而且，ArrayBlockingQueue默认会使用非公平锁。</li><br><li>  ArrayBlockingQueue与Condition是组合关系，ArrayBlockingQueue中包含两个Condition对象(notEmpty和notFull)。<br></li><br></ol><br><br><h2>3.ArrayBlockingQueue函数列表</h2>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> private ArrayBlockingQueue&lt;Integer&gt; queue=new ArrayBlockingQueue&lt;Integer&gt;(size);</span><br><span class="line">// 将指定的元素插入到此队列的尾部（如果立即可行且不会超过该队列的容量），在成功时返回 true，如果此队列已满，则抛出 IllegalStateException。</span><br><span class="line">    private boolean add(Integer num)&#123;</span><br><span class="line">       return queue.add(num);</span><br><span class="line">    &#125;</span><br><span class="line">// 将指定的元素插入到此队列的尾部（如果立即可行且不会超过该队列的容量），在成功时返回 true，如果此队列已满，则返回 false。</span><br><span class="line">    private boolean offer(Integer num)&#123;</span><br><span class="line">        return queue.offer(num);</span><br><span class="line">    &#125;</span><br><span class="line">/ 创建一个带有给定的（固定）容量和默认访问策略的 ArrayBlockingQueue。</span><br><span class="line">ArrayBlockingQueue(int capacity)</span><br><span class="line">// 创建一个具有给定的（固定）容量和指定访问策略的 ArrayBlockingQueue。</span><br><span class="line">ArrayBlockingQueue(int capacity, boolean fair)</span><br><span class="line">// 创建一个具有给定的（固定）容量和指定访问策略的 ArrayBlockingQueue，它最初包含给定 collection 的元素，并以 collection 迭代器的遍历顺序添加元素。</span><br><span class="line">ArrayBlockingQueue(int capacity, boolean fair, Collection&lt;? extends E&gt; c)</span><br><span class="line"></span><br><span class="line">    //TODO 将指定的元素插入此队列的尾部，如果该队列已满，则等待可用的空间。</span><br><span class="line">    private void put(Integer num) throws InterruptedException &#123;</span><br><span class="line">         queue.put(num);</span><br><span class="line">    &#125;</span><br><span class="line">    // 获取但不移除此队列的头；如果此队列为空，则返回 null。</span><br><span class="line">    private Integer peek()&#123;</span><br><span class="line">       return queue.peek();</span><br><span class="line">    &#125;</span><br><span class="line">    // 获取并移除此队列的头，如果此队列为空，则返回 null。</span><br><span class="line">    private Integer poll()&#123;</span><br><span class="line">        return queue.poll();</span><br><span class="line">    &#125;</span><br><span class="line">    //TODO 获取并移除此队列的头部，在元素变得可用之前一直等待（如果有必要）。</span><br><span class="line">    private Integer take() throws InterruptedException&#123;</span><br><span class="line">        return queue.take();</span><br><span class="line">    &#125;</span><br><span class="line">    // 从此队列中移除指定元素的单个实例（如果存在）</span><br><span class="line">    private boolean remove(Integer num)&#123;</span><br><span class="line">        return queue.remove(num);</span><br><span class="line">    &#125;</span><br><span class="line">    // 返回此队列中元素的数量。</span><br><span class="line">    private int getSize()&#123;</span><br><span class="line">      return queue.size();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p></p><h2>4.源码分析</h2><p></p>
<h3>创建</h3>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public ArrayBlockingQueue(int capacity, boolean fair) &#123;</span><br><span class="line">        if (capacity &lt;= 0)</span><br><span class="line">            throw new IllegalArgumentException();</span><br><span class="line">        this.items = new Object[capacity];//存放数组</span><br><span class="line">        lock = new ReentrantLock(fair); //互斥锁</span><br><span class="line">        notEmpty = lock.newCondition();//竞争条件</span><br><span class="line">        notFull =  lock.newCondition();//竞争条件</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">添加</span><br><span class="line">   offer() //队列满了返回false</span><br><span class="line">   add() //队列满了抛出异常</span><br><span class="line">   put() //队列慢了,阻塞线程</span><br><span class="line">取出</span><br><span class="line">   poll()//获取并移除此队列的头，如果此队列为空，则返回 null。</span><br><span class="line">   remove()//获取并移除此队列的头，如果为空,返回false</span><br><span class="line">   take() //获取并移除此队列的头部，在元素变得可用之前一直等待（如果有必要）。</span><br><span class="line">遍历</span><br><span class="line">   iterator() //符合Collection 接口</span><br></pre></td></tr></table></figure>
<p></p><h2>总结</h2><br>    这些API都不需要记忆,因为编程的时候,你可以查看API的实现原理.重点是要花时间把他看懂,知道为什么实现的.<p></p>
<p>5.思考题ArrayBlockingQueue示例<br>   一个线程打印1-52,一个线程打印A-Z<br>   要求控制台输出A12B34C56….Z5152</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shengfq.github.io/2018/10/23/Java 处理 XML 的三种主流技术及介绍/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shengfq's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/23/Java 处理 XML 的三种主流技术及介绍/" itemprop="url">Java 处理 XML 的三种主流技术及介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-23T00:00:00+08:00">
                2018-10-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###转载:顾彬, 冯晨, 和 乔彬<br>2012 年 8 月 13 日发布</p>
<p>最初，XML 语言仅仅是意图用来作为 HTML 语言的替代品而出现的，但是随着该语言的不断发展和完善，人们越来越发现它所具有的优点：例如标记语言可扩展，严格的语法规定，可使用有意义的标记，内容存储和表现分离等等优势注定了该语言从诞生之日起就会走向辉煌。 XML 语言在成为 W3C 标准之后进入到了一个快速发展的时期，当然它本身所具有的一系列优点和优势也注定了各大技术厂商对它的偏爱，Java 作为软件行业的一种开发技术也迅速作出了反应，出现了多种对 XML 支持的工具，本文将会从这个角度对 Java 处理 XML 的几种主流技术进行介绍，希望能对您有所帮助。在这篇文章中，您将会得到以下信息：</p>
<p>Java 提供了哪些优秀的类库及工具便于程序员对 XML 进行处理 ?<br>有了 DOM 了，其它工具类库还有必要么 ?<br>几个小例程带你快速了解这三种解析方式<br>Java 有哪些优秀的类库及工具便于程序员对 XML 进行处理 ?</p>
<p>大名鼎鼎的 DOM</p><br><p>绿色环保的 SAX</p><br><p>默默无闻的 Digester</p>

<p></p><h4>XML 三种解析方式简介</h4><br>大名鼎鼎的 DOM<p></p>
<p>说它大名鼎鼎可是一点不为过，DOM 是 W3C 处理 XML 的标准 API，它是许多其它与 XML 处理相关的标准的基础，不仅是 Java，其它诸如 Javascript，PHP，MS .NET 等等语言都实现了该标准， 成为了应用最为广泛的 XML 处理方式。当然，为了能提供更多更加强大的功能，Java 对于 DOM 直接扩展工具类有很多，比如很多 Java 程序员耳熟能详的 JDOM，DOM4J 等等， 它们基本上属于对 DOM 接口功能的扩充，保留了很多 DOM API 的特性，许多原本的 DOM 程序员甚至都没有任何障碍就熟练掌握了另外两者的使用，直观、易于操作的方式使它深受广大 Java 程序员的喜爱。</p>
<p>绿色环保的 SAX</p>
<p>SAX 的应运而生有它特殊的需要，为什么说它绿色环保呢，这是因为 SAX 使用了最少的系统资源和最快速的解析方式对 XML 处理提供了支持。 但随之而来繁琐的查找方式也给广大程序员带来许多困扰，常常令人头痛不已，同时它对 XPath 查询功能的支持，令人们对它又爱又恨。</p>
<p>默默无闻的 Digester：XML 的 JavaBean 化</p>
<p>Digester 是 apache 基金组织下的一个开源项目，笔者对它的了解源于对 Struts 框架的研究，是否有很多程序员想要一解各大开源框架的设计甚至想要自己写一个功能强大的框架时会碰到这样一个难题： 这些形形色色的用 XML 语言标记的框架配置文件，框架底层是用什么技术来解析呢？ DOM 解析耗费时间，SAX 解析又过于繁琐，况且每次解析系统开销也会过大， 于是，大家想到需要用与 XML 结构相对应的 JavaBean 来装载这些信息，由此 Digester 应运而生。它的出现为 XML 转换为 JavaBean 对象的需求带来了方便的操作接口，使得更多的类似需求得到了比较完美的解决方法， 不再需要程序员自己实现此类繁琐的解析程序了。与此同时 SUN 也推出了 XML 和 JavaBean 转换工具类 JAXB，有兴趣的读者可以自行了解。</p>
<p>三种解析方式比较<br><br>DOM</p>
<p>优缺点：实现 W3C 标准，有多种编程语言支持这种解析方式，并且这种方法本身操作上简单快捷，十分易于初学者掌握。其处理方式是将 XML 整个作为类似树结构的方式读入内存中以便操作及解析，因此支持应用程序对 XML 数据的内容和结构进行修改，但是同时由于其需要在处理开始时将整个 XML 文件读入到内存中去进行分析，因此其在解析大数据量的 XML 文件时会遇到类似于内存泄露以及程序崩溃的风险，请对这点多加注意。</p>
<p>适用范围：小型 XML 文件解析、需要全解析或者大部分解析 XML、需要修改 XML 树内容以生成自己的对象模型</p>
<p>SAX</p>
<p>SAX 从根本上解决了 DOM 在解析 XML 文档时产生的占用大量资源的问题。其实现是通过类似于流解析的技术，通读整个 XML 文档树，通过事件处理器来响应程序员对于 XML 数据解析的需求。由于其不需要将整个 XML 文档读入内存当中，它对系统资源的节省是十分显而易见的，它在一些需要处理大型 XML 文档以及性能要求较高的场合有起了十分重要的作用。支持 XPath 查询的 SAX 使得开发人员更加灵活，处理起 XML 来更加的得心应手。但是同时，其仍然有一些不足之处也困扰广大的开发人员：首先是它十分复杂的 API 接口令人望而生畏，其次由于其是属于类似流解析的文件扫描方式，因此不支持应用程序对于 XML 树内容结构等的修改，可能会有不便之处。</p>
<p>适用范围：大型 XML 文件解析、只需要部分解析或者只想取得部分 XML 树内容、有 XPath 查询需求、有自己生成特定 XML 树对象模型的需求</p>
<p>Digester/JAXB</p>
<p>优缺点 : 由于其是在上述两者的基础上衍生出来的工具类，为的是满足将 XML 转换为 JavaBean 的特殊需求，故而没有什么特别明显的优缺点。作为大名鼎鼎的开源框架 Struts 的 XML 解析工具 Digester，为我们带来了将 XML 转换为 JavaBean 的可靠方法。</p>
<p>适用范围 : 有将 XML 文档直接转换为 JavaBean 需求。</p>
<p>应用示例<br>下面给出一段用于解析的 XML 片段：</p>
<p>清单 1. XML 片段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; </span><br><span class="line">&lt;books&gt; </span><br><span class="line">  &lt;book id=&quot;001&quot;&gt; </span><br><span class="line">     &lt;title&gt;Harry Potter&lt;/title&gt; </span><br><span class="line">     &lt;author&gt;J K. Rowling&lt;/author&gt; </span><br><span class="line">  &lt;/book&gt; </span><br><span class="line">  &lt;book id=&quot;002&quot;&gt; </span><br><span class="line">     &lt;title&gt;Learning XML&lt;/title&gt; </span><br><span class="line">     &lt;author&gt;Erik T. Ray&lt;/author&gt; </span><br><span class="line">  &lt;/book&gt; </span><br><span class="line">&lt;/books&gt;</span><br></pre></td></tr></table></figure>
<p>DOM 解析 XML</p>
<p>Java 中的 DOM 接口简介： JDK 中的 DOM API 遵循 W3C DOM 规范，其中 org.w3c.dom 包提供了 Document、DocumentType、Node、NodeList、Element 等接口， 这些接口均是访问 DOM 文档所必须的。我们可以利用这些接口创建、遍历、修改 DOM 文档。</p>
<p>javax.xml.parsers 包中的 DoumentBuilder 和 DocumentBuilderFactory 用于解析 XML 文档生成对应的 DOM Document 对象。</p>
<p>javax.xml.transform.dom 和 javax.xml.transform.stream 包中 DOMSource 类和 StreamSource 类，用于将更新后的 DOM 文档写入 XML 文件。</p>
<p>下面给出一个运用 DOM 解析 XML 的例子：</p>
<p>清单 2. DOM 解析 XML</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">import java.io.File; </span><br><span class="line">import java.io.IOException; </span><br><span class="line">import javax.xml.parsers.DocumentBuilder; </span><br><span class="line">import javax.xml.parsers.DocumentBuilderFactory; </span><br><span class="line">import javax.xml.parsers.ParserConfigurationException; </span><br><span class="line">import org.w3c.dom.Document; </span><br><span class="line">import org.w3c.dom.Element; </span><br><span class="line">import org.w3c.dom.Node; </span><br><span class="line">import org.w3c.dom.NodeList; </span><br><span class="line">import org.xml.sax.SAXException; </span><br><span class="line"> </span><br><span class="line">public class DOMParser &#123; </span><br><span class="line">  DocumentBuilderFactory builderFactory = DocumentBuilderFactory.newInstance(); </span><br><span class="line">  //Load and parse XML file into DOM </span><br><span class="line">  public Document parse(String filePath) &#123; </span><br><span class="line">     Document document = null; </span><br><span class="line">     try &#123; </span><br><span class="line">        //DOM parser instance </span><br><span class="line">        DocumentBuilder builder = builderFactory.newDocumentBuilder(); </span><br><span class="line">        //parse an XML file into a DOM tree </span><br><span class="line">        document = builder.parse(new File(filePath)); </span><br><span class="line">     &#125; catch (ParserConfigurationException e) &#123; </span><br><span class="line">        e.printStackTrace();  </span><br><span class="line">     &#125; catch (SAXException e) &#123; </span><br><span class="line">        e.printStackTrace(); </span><br><span class="line">     &#125; catch (IOException e) &#123; </span><br><span class="line">        e.printStackTrace(); </span><br><span class="line">     &#125; </span><br><span class="line">     return document; </span><br><span class="line">  &#125; </span><br><span class="line">    </span><br><span class="line">  public static void main(String[] args) &#123; </span><br><span class="line">        DOMParser parser = new DOMParser(); </span><br><span class="line">        Document document = parser.parse(&quot;books.xml&quot;); </span><br><span class="line">        //get root element </span><br><span class="line">        Element rootElement = document.getDocumentElement(); </span><br><span class="line"> </span><br><span class="line">        //traverse child elements </span><br><span class="line">        NodeList nodes = rootElement.getChildNodes(); </span><br><span class="line">        for (int i=0; i &lt; nodes.getLength(); i++) </span><br><span class="line">        &#123; </span><br><span class="line">           Node node = nodes.item(i); </span><br><span class="line">           if (node.getNodeType() == Node.ELEMENT_NODE) &#123;   </span><br><span class="line">              Element child = (Element) node; </span><br><span class="line">              //process child element </span><br><span class="line">           &#125; </span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line">        NodeList nodeList = rootElement.getElementsByTagName(&quot;book&quot;); </span><br><span class="line">        if(nodeList != null) </span><br><span class="line">        &#123; </span><br><span class="line">           for (int i = 0 ; i &lt; nodeList.getLength(); i++) </span><br><span class="line">           &#123; </span><br><span class="line">              Element element = (Element)nodeList.item(i); </span><br><span class="line">              String id = element.getAttribute(&quot;id&quot;); </span><br><span class="line">           &#125; </span><br><span class="line">        &#125; </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的例子中，DOMParser 的 Parse() 方法负责解析 XML 文件并生成对应的 DOM Document 对象。其中 DocumentBuilderFactory 用于生成 DOM 文档解析器以便解析 XML 文档。 在获取了 XML 文件对应的 Document 对象之后，我们可以调用一系列的 API 方便的对文档对象模型中的元素进行访问和处理。 需要注意的是调用 Element 对象的 getChildNodes() 方法时将返回其下所有的子节点，其中包括空白节点，因此需要在处理子 Element 之前对节点类型加以判断。</p>
<p>可以看出 DOM 解析 XML 易于开发，只需要通过解析器建立起 XML 对应的 DOM 树型结构后便可以方便的使用 API 对节点进行访问和处理，支持节点的删除和修改等。 但是 DOM 解析 XML 文件时会将整个 XML 文件的内容解析成树型结构存放在内存中，因此不适合用 DOM 解析很大的 XML 文件。</p>
<p>SAX 解析 XML</p>
<p>与 DOM 建立树形结构的方式不同，SAX 采用事件模型来解析 XML 文档，是解析 XML 文档的一种更快速、更轻量的方法。 利用 SAX 可以对 XML 文档进行有选择的解析和访问，而不必像 DOM 那样加载整个文档，因此它对内存的要求较低。 但 SAX 对 XML 文档的解析为一次性读取，不创建任何文档对象，很难同时访问文档中的多处数据。</p>
<p>下面是一个 SAX 解析 XML 的例子：</p>
<p>清单 3. SAX 解析 XML</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">import org.xml.sax.Attributes; </span><br><span class="line">import org.xml.sax.SAXException; </span><br><span class="line">import org.xml.sax.XMLReader; </span><br><span class="line">import org.xml.sax.helpers.DefaultHandler; </span><br><span class="line">import org.xml.sax.helpers.XMLReaderFactory; </span><br><span class="line"> </span><br><span class="line">public class SAXParser &#123; </span><br><span class="line"> </span><br><span class="line">  class BookHandler extends DefaultHandler &#123; </span><br><span class="line">     private List&lt;String&gt; nameList; </span><br><span class="line">     private boolean title = false; </span><br><span class="line">   </span><br><span class="line">     public List&lt;String&gt; getNameList() &#123; </span><br><span class="line">        return nameList; </span><br><span class="line">     &#125; </span><br><span class="line">     // Called at start of an XML document </span><br><span class="line">     @Override </span><br><span class="line">     public void startDocument() throws SAXException &#123; </span><br><span class="line">        System.out.println(&quot;Start parsing document...&quot;); </span><br><span class="line">        nameList = new ArrayList&lt;String&gt;(); </span><br><span class="line">     &#125; </span><br><span class="line">     // Called at end of an XML document </span><br><span class="line">     @Override </span><br><span class="line">     public void endDocument() throws SAXException &#123;  </span><br><span class="line">        System.out.println(&quot;End&quot;);  </span><br><span class="line">     &#125; </span><br><span class="line">      </span><br><span class="line">     /** </span><br><span class="line">      * Start processing of an element. </span><br><span class="line">      * @param namespaceURI  Namespace URI </span><br><span class="line">      * @param localName  The local name, without prefix </span><br><span class="line">      * @param qName  The qualified name, with prefix </span><br><span class="line">      * @param atts  The attributes of the element </span><br><span class="line">      */ </span><br><span class="line">     @Override </span><br><span class="line">     public void startElement(String uri, String localName, String qName, </span><br><span class="line">        Attributes atts) throws SAXException &#123; </span><br><span class="line">        // Using qualified name because we are not using xmlns prefixes here. </span><br><span class="line">        if (qName.equals(&quot;title&quot;)) &#123; </span><br><span class="line">           title = true; </span><br><span class="line">        &#125; </span><br><span class="line">     &#125; </span><br><span class="line">   </span><br><span class="line">     @Override </span><br><span class="line">     public void endElement(String namespaceURI, String localName, String qName) </span><br><span class="line">        throws SAXException &#123; </span><br><span class="line">        // End of processing current element </span><br><span class="line">        if (title) &#123; </span><br><span class="line">           title = false; </span><br><span class="line">        &#125; </span><br><span class="line">     &#125; </span><br><span class="line">            </span><br><span class="line">     @Override </span><br><span class="line">     public void characters(char[] ch, int start, int length) &#123; </span><br><span class="line">        // Processing character data inside an element </span><br><span class="line">        if (title) &#123; </span><br><span class="line">           String bookTitle = new String(ch, start, length); </span><br><span class="line">           System.out.println(&quot;Book title: &quot; + bookTitle); </span><br><span class="line">           nameList.add(bookTitle); </span><br><span class="line">        &#125; </span><br><span class="line">     &#125; </span><br><span class="line">            </span><br><span class="line">  &#125; </span><br><span class="line">    </span><br><span class="line">  public static void main(String[] args) throws SAXException, IOException &#123; </span><br><span class="line">     XMLReader parser = XMLReaderFactory.createXMLReader(); </span><br><span class="line">     BookHandler bookHandler = (new SAXParser()).new BookHandler(); </span><br><span class="line">     parser.setContentHandler(bookHandler); </span><br><span class="line">     parser.parse(&quot;books.xml&quot;); </span><br><span class="line">     System.out.println(bookHandler.getNameList()); </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SAX 解析器接口和事件处理器接口定义在 org.xml.sax 包中。主要的接口包括 ContentHandler、DTDHandler、EntityResolver 及 ErrorHandler。 其中 ContentHandler 是主要的处理器接口，用于处理基本的文档解析事件；DTDHandler 和 EntityResolver 接口用于处理与 DTD 验证和实体解析相关的事件； ErrorHandler 是基本的错误处理接口。DefaultHandler 类实现了上述四个事件处理接口。上面的例子中 BookHandler 继承了 DefaultHandler 类， 并覆盖了其中的五个回调方法 startDocument()、endDocument()、startElement()、endElement() 及 characters() 以加入自己的事件处理逻辑。</p>
<p>Digester 解析 XML</p>
<p>为了满足将 XML 转换为 JavaBean 的特殊需求，Apache 旗下的一个名为 Digester 的工具为我们提供了这么一个选择。由于最终是将 XML 转化为 JavaBean 存储在内存当中， 故而解析性能等方面其实与使用者并没有多大关系。解析的关键在于用以匹配 XML 的模式以及规则等，由于该工具较为复杂，限于篇幅，作者只能给予简单的介绍。</p>
<p>下面是一个 Digester 解析 XML 的例子片段：</p>
<p>清单 4. Digester 解析 XML</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 定义要解析的 XML 的路径，并初始化工具类</span><br><span class="line">File input = new File(&quot;books.xml&quot;); </span><br><span class="line">Digester digester = new Digester(); </span><br><span class="line"> </span><br><span class="line">// 如果碰到了 &lt;books&gt; 这个标签，应该初始化 test.myBean.Books 这个 JavaBean 并填装相关内容</span><br><span class="line">digester.addObjectCreate(&quot;books&quot;, &quot;test.myBean.Books&quot;); </span><br><span class="line">digester.addSetProperties(&quot;books&quot;); </span><br><span class="line">// 如果碰到了 &lt;books/book&gt; 这个标签，同上初始化 test.myBean.Book 这个 JavaBean </span><br><span class="line">digester.addObjectCreate(&quot;books/book&quot;, &quot;test.myBean.Book&quot;); </span><br><span class="line">digester.addSetProperties(&quot;books/book&quot;); </span><br><span class="line">// 通过调用上面已经初始化过的 JavaBean 的 addBook() 方法来把多个 &lt;books/book&gt; 加到一个集合中</span><br><span class="line">digester.addSetNext(&quot;books/book&quot;, &quot;addBook&quot;, &quot;test.myBean.Book&quot;); </span><br><span class="line"> </span><br><span class="line">// 定义好了上面的解析规则后，就可以开始进行解析工作了</span><br><span class="line">Books books = (Books) digester.parse(input);</span><br></pre></td></tr></table></figure>
<p>上述代码简单的向读者展示了 Digester 处理 XML 的一些要点，主要是说明了一些模式以及规则的匹配。 简言之，Digester 就是一种用来把一个 XML 转化为一个与该 XML 结构类似的 JavaBean。你可以把 XML 根元素想象成一个 JavaBean， 该根元素的 attribute 就是这个 JavaBean 的各种 Field，当该根元素有其他子 tag 时，又要把这个子 tag 想象成一个个新的 XML，将其视为一个新的 JavaBean， 并作为一个 Field 加入到父 Bean 当中，然后以此类推，通过循环的方式将整个 XML 进行解析。</p>
<p>结束语<br><br>本文介绍了 Java 解析 XML 的三种常用技术，其中 DOM 易于上手，程序易于理解，但缺点在于占用内存大，不适合于解析较大的 XML 文件； SAX 基于事件模型占用系统资源少，能够胜任较大的 XML 文件解析，但解析过程较为繁琐查找元素不方便； Digester/JAXB 基于上述两种技术衍生而来。文中的实例向读者展示了三种 API 的基本使用方法， 在实际开发过程中使用那种技术解析 XML 更好要依据各自的优缺点视具体情况而定。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shengfq.github.io/2018/09/23/遗留系统的异常处理办法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shengfq's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/23/遗留系统的异常处理办法/" itemprop="url">遗留系统的异常处理办法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-23T19:43:27+08:00">
                2018-09-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p></p><h5>遗留系统的异常处理办法</h5><p></p>
<p></p><h5>背景</h5><br>OA7.0是一个跨度较大的版本，拷贝了客户生产环境的webapp/resources/data 就可以在本地搭建其测试环境。<br>根据客户的二开策略，我修改了数据源等个性化配置信息后遇到了些问题：<br>1.启动报各种异常导致无法启动成功<br>2.启动成功后，使用用户名和密码都无法登录成功<br>在这种情形下，就要进入具体的报错点，熟悉类的加载过程。<p></p>
<pre>java.lang.NoClassDefFoundError: Could not initialize class org.springside.core.Constants

Oracle 的解释是：
Thrown if the Java Virtual Machine or a ClassLoader instance tries to load in the definition of a class (as part of a normal method call or as part of creating a new instance using the new expression) and no definition of the class could be found.
The searched-for class definition existed when the currently executing class was compiled, but the definition can no longer be found.

当java虚拟机或者类加载器实例尝试加载定义的类时，却没有找到该类的定义。
</pre>

<p></p><h5>解决思路</h5><p></p>
<p></p><p>注释法</p><br>类会先加载static块，采用二分法的方式注释一部分方法调用，看问题是否存在。<p></p>
<p></p><p>日志法</p><br>生产环境的问题无法debug，但是可以通过详细的日志调用，知道执行了哪些问题。<p></p>
<p></p><p>反编译法</p><br>因为jar包里面的代码无法打断点，可以将类反编译出来，jdk会优先调用classes目录的字节码。<p></p>
<p></p><p>异常定位法</p><br>既然是抛出了异常导致启动不成功，那么异常是哪里引起的，可以通过增加try…catch来捕获异常，定位异常点，记录异常信息。<p></p>
<p></p><h5>最终解决</h5><br>原来是Constants类调用了Lisences.jar里面的方法导致抛出异常而没有处理，导致程序异常中断，static块没有执行完成，类加载器无法<br>初始化Constants实例。所以遗留系统里面的问题就是写了大量的没有异常处理机制的代码，既没有自主处理异常，也没有抛出异常，告知调用者<br>可能会出现的异常，通过上述的四个方法基本上可以找到问题点，解决之。<p></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shengfq.github.io/2018/08/28/2011我的项目管理之旅/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shengfq's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/28/2011我的项目管理之旅/" itemprop="url">我的项目管理之旅</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-28T19:43:27+08:00">
                2018-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2011年进入我第二家公司邦德瑞科技，我就有预感，未来的职业发展道路很好走，因为我是被领导从工厂里带出来创业的。<br>我的上司就是我的老师，在我第一年上班的时候看上了我，带我去他的公司创业，继续做楼宇暖通自动化应用软件。一时自己<br>还没有其他的打算，二就是觉得自己兴趣也在，老师也信任，就是没经验，经验都是从经历中学到的，当时就觉得不做会后悔。</p>
<p>进入创业公司，同事基本是原来工厂的同事，我们软件组三个人，两个女生，重担自然落在我身上，责无旁贷，我负责产品研发项目<br>管理，当时我是个毕业一年的小伙子，没有任何项目管理的基础，老师也没有让我直接当司令负责发号施令，而是把我打发到了我们的<br>项目现场，第一个项目就是广州方圆酒店的温控器联网。我们的产品在当时还没有地图监控，只有楼宇结构监控，组控和定时控。我到了<br>现场之前，第一件事就是把项目的图纸全部打印出来，进行末端设备组网编号。过去现场调试联网1个月左右，软件准备上线，我们的经销商看了<br>我们的软件后觉得不够直观，最好能用颜色来区分不同状态的设备，如离线，开机，关机，制冷，制热。当时经销商都提了很多需求，用户只有<br>物业的监控人员，所以他们基本不会提什么需求，只要会用就行。但我们还是奔着要把软件做好的想法，利用项目上的机会不断优化，<br>于是我把我开发的同事叫到了项目现场，我们把需求分期执行，一段一段的更新交付使用，我负责需求整理成文档，建立业务领域模型，与开发<br>同事一起进行底层面向对象的数据表建模和程序功能规划，她开发，我检修测试，这样直到可以交付使用后，我通知物业方进行软件验收和培训。<br>通过这次项目，我们收集的产品功能需求是很大的，回去之后，我们就开会，把当时临时改的代码进行重构和修复bug。这样，我们的第一套BAS楼宇<br>末端设备监控软件就依靠项目的使用经验不断的完善代码和功能，每次版本更新我都会更新到我们的ftp服务器上，文档也会更新，项目部同事必须学<br>会使用，而且给客户的安装光盘都是最新版本。</p>
<p>2012年，我的上司提出了更高的目标和期望，要做末端计费系统，因为中央空调末端的计费模式太老按面积收费不合理，要通过设备科学计量收费是趋势。<br>瞄向的是未来新的楼宇建筑节能减排项目和旧有楼宇改造项目。当时我们接了武汉一个小区的项目就开始做了，先做硬件计量表计，再调试实施联网，后续是上线<br>监控计费软件，培训客户使用。但我们手里的东西只有一套BAS系统，于是结合第一套系统，我们摈弃了第一套的不足，设计监控端和服务端分离模式，通过udp心跳维持<br>通讯，跟设备通讯网关也是采用udp广播寻址，udp心跳维持在线的方式（这套通讯是我当时提出来的，就是用到了协议的优点为我们系统服务）。<br>项目进行到下半年后，两女生有私事要离开深圳，这对于我们这个项目来说是非常大的损失，很可能就会夭折。当时我领导找到我，不要怕，没人开发咱们可以招人，只要<br>你还有信心，就可以带起来，因为你的经验是最丰富的，当时我也不甘心就这样算了，没人咱们可以招，而我是非常自信能带好团队干成这件事的，于是就跟老师去人才市场<br>招聘两个.net的毕业生开干，我根据一本《走出软件作坊》边学边实践，我自己有产品经验的底子，也有开发的底子，那么按照成事的原则，业务，技术，团队三要素具备其二就能<br>成，我们具备了业务和技术两个，团队可以慢慢带起来，于是就搭建svn项目，我就规划了三期的产品目标，分别指明了需要达到的功能条件，而不是想到一处就是一处，比如<br>前端后端分离，前端的功能规划，后端的后台任务规划，控制网关的数据提供，抄表，通讯，达到能注册设备，监控设备的第一期需求，第二期就是结算，账单，第三期就是收费，单据，报表。<br>然后根据开发同事的实际兴趣爱好和擅长点进行任务认领，当时我的想法是激励为主，自主认领任务，我来负责协调资源和功能验收。我们的开发团队五个人。<br>到了2013年底，要出差调试，我也是主动请缨去客户现场熟悉业务，指导现场施工人员安装设备联网，指导物业的维修和客服进行系统的操作，把她们遇到的问题一一记录下来，系统的bug也<br>都记录下来反馈给我的同事，在进行设备注册的时候，忙不过来，运营方要求在夏季结束前必须完成所有用户的注册，找来了4个临时工作人员给我，安排他们分工协作来使用系统，自己<br>负责重点的系统漏洞和业务漏洞的报告和方案思考，重复的事情交给他们做。曾经因为一个设计缺陷导致关联的数据没有联系，只能将注册的资料重新通过导数据的方式，客户现场工地<br>睡了2个月，终于在2013年底，我们的软件系统可以做到实时监控，按日抄表，按月结算出账单，没有成功的可以手动结算录入，有抄表错误的住户可以查到历史报表，得到用户的空调<br>使用报表记录，为此，公司还给我发了一个大红包鼓励。</p>
<p>2014年，我们的计费项目越来越多，销售同事和各地的经销商都来看，公司参加了两届制冷展，推出品牌系统。给我们带来了很大的压力和挑战，站在国内水平线上，都只有几家有这样的系统。<br>不同的项目，需求也不一样，但是我们开发人员不能疲于奔波修复各种需求和bug，于是我做出了调整。根据开发同事的水平和兴趣，使用项目管理系统规范化项目协同作业，规范测试提单，产品提需求，开发人员开发完成和bug修复。能力强的负责重要业务的重构和大bug的修复。能力弱点的负责新需求的开发和简单bug的处理，尽量按模块来分配，一般我们客户端比较简单，服务端性能问题比较严重，分开开发，做前端的Ui熟悉，做后端的并发性能问题解决。这样我们这套系统才从开发模式上慢慢走向日常，而不是前期的救火状态。</p>
<p>项目管理其实是一项综合性的学科，涉及参与者有产品，开发，测试。如果还有客户参与进来还包括客户服务和实施规划。不论是多少人参与，每个角色的定义边界项目经理要清晰，就算是一个人维护，也要分清楚哪些是产品角色，开发角色，测试角色该做的事情，而不是眉毛胡子一把抓。人多的时候也只是扩充了角色人员，提升了多任务效率。<br>做项目管理前，可以先做项目助理，深入到客户第一线，体验产品功能带来的体验和不足，有了一定的产品认知也就能对产品人员提的需求有一个自主的判断和筛选。其实每个角色深入下去都是一个非常关键的岗位，但是前期是项目经理牵头，任务下来了，第一步就是理清楚上下文关系，确定好问题的重点，纠结点集中优势力量解决或者放弃。先完成后完善，推动项目按照预定的里程碑在deadline前完成交付才是一个优秀项目经理的首要工作。<br></p><p></p>
<p>写于2018-8-28夜</p>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shengfq.github.io/2018/05/26/socket客户端监控案例/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shengfq's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/26/socket客户端监控案例/" itemprop="url">socket客户端监控案例</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-26T19:43:27+08:00">
                2018-05-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="java-socket-监控案例包含"><a href="#java-socket-监控案例包含" class="headerlink" title="java socket 监控案例包含"></a>java socket 监控案例包含</h3><pre>
1.客户端
 1.1 客户端心跳线程
 1.2 客户端消息发送线程
 1.3 客户端消息接收线程 
 1.4 客户端启动,关闭 方法
 1.5 接收处理器接口(心跳接收,消息接收)


2.服务端
    2.1 服务端链接看门口线程
    2.2 服务端接收线程
    2.3 服务端启动,关闭方法
    2.4 接受处理器接口(心跳接收,消息接收)

3.心跳包
    3.1 包含的时间戳和id字段

4.普通消息
    4.4 消息正文,消息类型

5.异常处理
    5.1套接字异常的处理办法

</pre>

<hr>
<h4 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">package client;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.io.ObjectInputStream;</span><br><span class="line">import java.io.ObjectOutputStream;</span><br><span class="line">import java.net.ServerSocket;</span><br><span class="line">import java.net.Socket;</span><br><span class="line">import java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by sheng on 17/12/4.</span><br><span class="line"> */</span><br><span class="line">public class Server &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 要处理客户端发来的对象，并返回一个对象，可实现该接口。</span><br><span class="line">     */</span><br><span class="line">    public interface ObjectAction&#123;</span><br><span class="line">        Object doAction(Object rev, Server server);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public  final class DefaultObjectAction implements ObjectAction&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public Object doAction(Object rev,Server server) &#123;</span><br><span class="line">            KeepAlive keepAlive=(KeepAlive)rev;</span><br><span class="line">            System.out.println(&quot;接收数据,心跳包处理：\t&quot;+keepAlive.toString());</span><br><span class="line">            //心跳包解析</span><br><span class="line">            return keepAlive;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public  class MsgObjectAction implements ObjectAction&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public Object doAction(Object obj, Server server) &#123;</span><br><span class="line">            Message message=(Message)obj;</span><br><span class="line">            System.out.println(&quot;接收数据,消息包处理：\t&quot;+message.toString());</span><br><span class="line">            // TODO 消息解析</span><br><span class="line">            return message;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        int port = 65432;</span><br><span class="line">        Server server = new Server(port);</span><br><span class="line">        server.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private int port;</span><br><span class="line">    //线程运行状态控制</span><br><span class="line">    private volatile boolean running=false;</span><br><span class="line">    //接收超时时间</span><br><span class="line">    private long receiveTimeDelay=3000;</span><br><span class="line">    private ConcurrentHashMap&lt;Class&lt;Object&gt;, ObjectAction&gt; actionMapping = new ConcurrentHashMap&lt;Class&lt;Object&gt;,ObjectAction&gt;();</span><br><span class="line">    private Thread connWatchDog;</span><br><span class="line">    public Server(int port) &#123;</span><br><span class="line">        this.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void start()&#123;</span><br><span class="line">        if(running)&#123;return;&#125;</span><br><span class="line">        running=true;</span><br><span class="line">        connWatchDog = new Thread(new ConnWatchDog());</span><br><span class="line">        connWatchDog.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void stop()&#123;</span><br><span class="line">        if(running)&#123;running=false;&#125;</span><br><span class="line">        if(connWatchDog!=null)&#123;connWatchDog.stop();&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void addActionMap(Class&lt;Object&gt; cls,ObjectAction action)&#123;</span><br><span class="line">        actionMapping.put(cls, action);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ConnWatchDog implements Runnable&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run()&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                System.out.println(&quot;server initial....&quot;);</span><br><span class="line">                ServerSocket ss = new ServerSocket(port,5);</span><br><span class="line">                while(running)&#123;</span><br><span class="line">                    Socket s = ss.accept();</span><br><span class="line">                    System.out.println(&quot;server accept one client ....&quot;);</span><br><span class="line">                    new Thread(new ReceiveWatchDogs(s)).start();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                Server.this.stop();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ReceiveWatchDogs implements Runnable&#123;</span><br><span class="line">        Socket s;</span><br><span class="line">        boolean run=true;</span><br><span class="line">        long lastReceiveTime = System.currentTimeMillis();</span><br><span class="line">        KeepAlive lastKeepAlive;</span><br><span class="line">        public ReceiveWatchDogs(Socket s) &#123;</span><br><span class="line">            this.s = s;</span><br><span class="line">        &#125;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            while(running &amp;&amp; run)&#123;</span><br><span class="line">                if(System.currentTimeMillis()-lastReceiveTime&gt;receiveTimeDelay)&#123;</span><br><span class="line">                    overThis(lastKeepAlive);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        InputStream in = s.getInputStream();</span><br><span class="line">                        if(in.available()&gt;0)&#123;</span><br><span class="line">                            ObjectInputStream ois = new ObjectInputStream(in);</span><br><span class="line">                            Object obj = ois.readObject();</span><br><span class="line">                            lastReceiveTime = System.currentTimeMillis();</span><br><span class="line">                            System.out.println(&quot;server receive... :\t&quot;+obj);</span><br><span class="line">                            if(obj instanceof Message)&#123;</span><br><span class="line">                                addActionMap((Class&lt;Object&gt;) obj.getClass(),new MsgObjectAction());</span><br><span class="line">                            &#125;else if(obj instanceof KeepAlive)&#123;</span><br><span class="line">                                this.lastKeepAlive=(KeepAlive) obj;</span><br><span class="line">                                addActionMap((Class&lt;Object&gt;) obj.getClass(),new DefaultObjectAction());</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            ObjectAction oa = actionMapping.get(obj.getClass());</span><br><span class="line">                            oa = oa==null?new DefaultObjectAction():oa;</span><br><span class="line">                            Object out = oa.doAction(obj,Server.this);</span><br><span class="line">                        &#125;else&#123;</span><br><span class="line">                            Thread.sleep(10);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; catch (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        overThis(this.lastKeepAlive);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void overThis(KeepAlive keepAlive) &#123;</span><br><span class="line">            if(run)&#123;run=false;&#125;</span><br><span class="line">            if(s!=null)&#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    s.close();</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;System.out.println(&quot;client &quot;+keepAlive.getId()+&quot;  离线&quot;);</span><br><span class="line">            System.out.println(&quot;client connect over time....&quot;+s.getRemoteSocketAddress());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line">package client;</span><br><span class="line">import java.io.ObjectOutputStream;</span><br><span class="line">import java.net.Socket;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.io.ObjectInputStream;</span><br><span class="line">import java.net.UnknownHostException;</span><br><span class="line">import java.util.Scanner;</span><br><span class="line">import java.util.concurrent.ConcurrentHashMap;</span><br><span class="line">import java.util.concurrent.RunnableFuture;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by sheng on 17/12/13.</span><br><span class="line"> * 客户端可以发送心跳包/消息包,在 keepAliveDelay毫秒内未发送任何数据,则自动发送一个KeepAlive Object(心跳)给服务器.</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">public class Client &#123;</span><br><span class="line">    //sendObject 发送</span><br><span class="line"></span><br><span class="line">    //Message Object 消息</span><br><span class="line"></span><br><span class="line">    //keepAliveDelay 延时</span><br><span class="line"></span><br><span class="line">    //KeepAlive Object</span><br><span class="line"></span><br><span class="line">    //addActionMap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 处理服务端发回的对象，可实现该接口。</span><br><span class="line">     */</span><br><span class="line">    public  interface ObjectAction&#123;</span><br><span class="line">        void doAction(Object obj,Client client);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static final class DefaultObjectAction implements ObjectAction&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void doAction(Object obj,Client client) &#123;</span><br><span class="line">            KeepAlive alive=(KeepAlive) obj;</span><br><span class="line">            System.out.println(&quot;接收数据,心跳包处理：\t&quot;+alive.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class MsgObjectAction implements ObjectAction&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void doAction(Object obj, Client client) &#123;</span><br><span class="line">            Message message=(Message) obj;</span><br><span class="line">            System.out.println(&quot;接收数据,消息包处理：\t&quot;+message.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws UnknownHostException, IOException &#123;</span><br><span class="line">        String serverIp = &quot;127.0.0.1&quot;;</span><br><span class="line">        int port = 65432;</span><br><span class="line">        Client client = new Client(serverIp,port);</span><br><span class="line">        KeepAlive keepAlive=new KeepAlive(&quot;2&quot;,&quot;2&quot;,&quot;2&quot;);</span><br><span class="line">        client.start(keepAlive);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private String serverIp;</span><br><span class="line">    private int port;</span><br><span class="line">    private Socket socket;</span><br><span class="line">    //连接状态</span><br><span class="line">    private boolean running=false;</span><br><span class="line">    //最后一次发送数据的时间</span><br><span class="line">    private long lastSendTime;</span><br><span class="line"></span><br><span class="line">    //用于保存接收消息对象类型及该类型消息处理的对象</span><br><span class="line">    private ConcurrentHashMap&lt;Class, ObjectAction&gt; actionMapping = new ConcurrentHashMap&lt;Class,ObjectAction&gt;();</span><br><span class="line"></span><br><span class="line">    public Client(String serverIp, int port) &#123;</span><br><span class="line">        this.serverIp=serverIp;</span><br><span class="line">        this.port=port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void start(KeepAlive keepAlive) throws UnknownHostException, IOException &#123;</span><br><span class="line">        if(running)return;</span><br><span class="line">        socket = new Socket(serverIp,port);</span><br><span class="line">        System.out.println(&quot;本地端口：&quot;+socket.getLocalPort());</span><br><span class="line">        lastSendTime=System.currentTimeMillis();</span><br><span class="line">        running=true;</span><br><span class="line">        //保持长连接的线程，每隔2秒项服务器发一个一个保持连接的心跳消息</span><br><span class="line">        new Thread(new KeepAliveWatchDog(keepAlive)).start();</span><br><span class="line">        //接受消息的线程，处理消息</span><br><span class="line">        new Thread(new ReceiveWatchDog()).start();</span><br><span class="line">        //发送消息线程.</span><br><span class="line">        new Thread(new SendMsgPacket()).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void stop()&#123;</span><br><span class="line">        if(running)running=false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 添加接收对象的处理对象。</span><br><span class="line">     * @param cls 待处理的对象，其所属的类。</span><br><span class="line">     * @param action 处理过程对象。</span><br><span class="line">     */</span><br><span class="line">    public void addActionMap(Class&lt;? extends Object&gt; cls, ObjectAction action)&#123;</span><br><span class="line">        actionMapping.put(cls, action);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void sendObject(Object obj) throws IOException &#123;</span><br><span class="line">        ObjectOutputStream oos = new ObjectOutputStream(socket.getOutputStream());</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;client send..：\t&quot;+obj);</span><br><span class="line">        oos.flush();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 心跳包发送</span><br><span class="line">     * */</span><br><span class="line">    class KeepAliveWatchDog implements Runnable&#123;</span><br><span class="line">        KeepAlive keepAlive;</span><br><span class="line">        public KeepAliveWatchDog(KeepAlive keepAlive)&#123;</span><br><span class="line">            this.keepAlive=keepAlive;</span><br><span class="line">        &#125;</span><br><span class="line">        long checkDelay = 10;</span><br><span class="line">        long keepAliveDelay = 2000;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            while(running)&#123;</span><br><span class="line">                if(System.currentTimeMillis()-lastSendTime&gt;keepAliveDelay)&#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        KeepAlive alive=this.keepAlive;</span><br><span class="line">                        Client.this.sendObject(alive);</span><br><span class="line">                        addActionMap(alive.getClass(),new DefaultObjectAction());</span><br><span class="line">                    &#125; catch (IOException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        Client.this.stop();</span><br><span class="line">                    &#125;</span><br><span class="line">                    lastSendTime = System.currentTimeMillis();</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        //线程休眠10毫秒</span><br><span class="line">                        Thread.sleep(checkDelay);</span><br><span class="line">                    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        Client.this.stop();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class SendMsgPacket implements Runnable&#123;</span><br><span class="line">        boolean isrunning=true;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            //接收控制台输入</span><br><span class="line">            Scanner input=new Scanner(System.in);</span><br><span class="line">            while(input.hasNext() &amp;&amp; isrunning)&#123;</span><br><span class="line">                String str = input.next();</span><br><span class="line">                if(str.equals(&quot;cancel&quot;))&#123;</span><br><span class="line">                    isrunning=false;</span><br><span class="line">                    Client.this.stop();</span><br><span class="line">                &#125;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Message msg = new Message(str, 0);</span><br><span class="line">                    Client.this.sendObject(msg);</span><br><span class="line">                    addActionMap(msg.getClass(),new MsgObjectAction());</span><br><span class="line">                &#125;catch(IOException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    Client.this.stop();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ReceiveWatchDog implements Runnable&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            while(running)&#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    InputStream in = socket.getInputStream();</span><br><span class="line">                    if(in.available()&gt;0)&#123;</span><br><span class="line">                        ObjectInputStream ois = new ObjectInputStream(in);</span><br><span class="line">                        Object obj = ois.readObject();</span><br><span class="line">                        System.out.println(&quot;client receive ....:\t&quot;+obj);</span><br><span class="line">                        ObjectAction oa = actionMapping.get(obj.getClass());</span><br><span class="line">                        oa = oa==null?new DefaultObjectAction():oa;</span><br><span class="line">                        oa.doAction(obj, Client.this);</span><br><span class="line">                    &#125;else&#123;</span><br><span class="line">                        Thread.sleep(10);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    Client.this.stop();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="心跳包"><a href="#心跳包" class="headerlink" title="心跳包"></a>心跳包</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">package client;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;  </span><br><span class="line">import java.text.SimpleDateFormat;  </span><br><span class="line">import java.util.Date;  </span><br><span class="line">  </span><br><span class="line">/**  </span><br><span class="line"> *   </span><br><span class="line"> * 维持连接的消息对象（心跳对象）  </span><br><span class="line"> */  </span><br><span class="line">public class KeepAlive implements Serializable&#123;  </span><br><span class="line">    private String id;</span><br><span class="line">    private String ip;</span><br><span class="line">    private String timestamp=new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(new Date());</span><br><span class="line">    private String mac;</span><br><span class="line"></span><br><span class="line">    public KeepAlive(String id,String ip,String mac)&#123;</span><br><span class="line">        this.id=id;</span><br><span class="line">        this.ip=ip;</span><br><span class="line">        this.mac=mac;</span><br><span class="line">    &#125;</span><br><span class="line">    private static final long serialVersionUID = -2813120366138988480L;</span><br><span class="line">    public String getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(String id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getIp() &#123;</span><br><span class="line">        return ip;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setIp(String ip) &#123;</span><br><span class="line">        this.ip = ip;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getMac() &#123;</span><br><span class="line">        return mac;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMac(String mac) &#123;</span><br><span class="line">        this.mac = mac;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTimestamp() &#123;</span><br><span class="line">        return timestamp;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     *  覆盖该方法，仅用于测试使用。</span><br><span class="line">     * @see java.lang.Object#toString()  </span><br><span class="line">     */  </span><br><span class="line">    @Override  </span><br><span class="line">    public String toString()</span><br><span class="line">    &#123;</span><br><span class="line">        StringBuffer sb=new StringBuffer(new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(new Date()));</span><br><span class="line">        sb.append(&quot;||&quot;).append(this.id);</span><br><span class="line">        sb.append(&quot;||&quot;).append(this.ip);</span><br><span class="line">        sb.append(&quot;||&quot;).append(this.mac);</span><br><span class="line">        return sb.toString();</span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="普通消息类型"><a href="#普通消息类型" class="headerlink" title="普通消息类型"></a>普通消息类型</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package client;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by sheng on 17/12/14.</span><br><span class="line"> */</span><br><span class="line">public class Message implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID = -2813120366138988480L;</span><br><span class="line">    public Message()&#123;&#125;</span><br><span class="line">    public Message(String msg,Integer type)&#123;</span><br><span class="line">        this.msg=msg;</span><br><span class="line">        this.type=type;</span><br><span class="line">    &#125;</span><br><span class="line">    private String msg;</span><br><span class="line">    private Integer type;</span><br><span class="line"></span><br><span class="line">    public String getMsg() &#123;</span><br><span class="line">        return msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMsg(String msg) &#123;</span><br><span class="line">        this.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getType() &#123;</span><br><span class="line">        return type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setType(Integer type) &#123;</span><br><span class="line">        this.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Message&#123;&quot; +</span><br><span class="line">                &quot;msg=&apos;&quot; + msg + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, type=&quot; + type +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h4><p>socket的异常往往是连接超时引起,如果socket丢失,则操作socket会引起IOException,只需要在异常处理中,将socket释放,将线程的run()结束就行了.</p>
<p>write by shengfq 17/12/13.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shengfq.github.io/2018/05/24/aboutme/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shengfq's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/24/aboutme/" itemprop="url">aboutme</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-24T19:29:54+08:00">
                2018-05-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>盛富强<br>安卓开发工程师<br>联系电话:+86 132-6675-0060<br>电子邮箱:<a href="mailto:shengfu.qiang@163.com" target="_blank" rel="noopener">shengfu.qiang@163.com</a><br>个人博客:<a href="https://shengfq.github.io/">https://shengfq.github.io/</a><br>github:<a href="https://github.com/shengfq" target="_blank" rel="noopener">https://github.com/shengfq</a></p>
<p>自我描述</p>
<h2 id="我是一名热爱分享-爱开源-爱谷歌的安卓开发者"><a href="#我是一名热爱分享-爱开源-爱谷歌的安卓开发者" class="headerlink" title="我是一名热爱分享,爱开源,爱谷歌的安卓开发者."></a>我是一名热爱分享,爱开源,爱谷歌的安卓开发者.</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shengfq.github.io/2018/05/24/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shengfq's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/24/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-24T18:25:38+08:00">
                2018-05-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">盛富强</p>
              <p class="site-description motion-element" itemprop="description">blogs and research</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/shengfq" target="_blank" title="github">
                      
                        <i class="fa fa-fw fa-globe"></i>github</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">盛富强</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
